workflows:
  - workflowId: browseProductsInOnLineStoreCatalog
    summary: "A workflow that guides users through the process of browsing and selecting products in the OnLineStore catalog."
    description: "Browse Products in OnLineStore Catalog"
    steps:
      - stepId: selectStoreAndLanguage
        description: "User chooses their country/store and preferred language."
        operationId: getWWCountries
        parameters: []
        successCriteria:
          - condition: $statusCode == 200
        outputs:
          storeId: $response.body.countries[0].storeId
          languageId: $response.body.countries[0].supportedLanguages[0].id
          selectedLocale: $response.body.countries[0].supportedLanguages[0].locale

      - stepId: loginUser
        description: "Log in and obtain session token."
        operationPath: login
        parameters: []
        successCriteria:
          - condition: $statusCode == 200
        outputs:
          sessionToken: $response.body.sessionToken

      - stepId: browseMenu
        description: "User browses through the menu to find desired categories."
        operationId: navigationMenu
        parameters:
          - name: storeId
            in: path
            value: $steps.selectStoreAndLanguage.outputs.storeId
          - name: languageId
            in: path
            value: $steps.selectStoreAndLanguage.outputs.languageId
          - name: sessionToken
            in: header
            value: $steps.loginUser.outputs.sessionToken
        successCriteria:
          - condition: $statusCode == 200
        outputs:
          selectedCategoryId: $response.body.menuItems[0].subcategories[0].id

      - stepId: getGrid
        description: "Retrieve the product grid for the selected category."
        operationId: gridByCategoryId
        parameters:
          - name: storeId
            in: path
            value: $steps.selectStoreAndLanguage.outputs.storeId
          - name: categoryId
            in: path
            value: $steps.browseMenu.outputs.selectedCategoryId
          - name: languageId
            in: path
            value: $steps.selectStoreAndLanguage.outputs.languageId
        successCriteria:
          - condition: $statusCode == 200
        outputs:
          productId: $response.body.gridSections[0].elements[0].id

      - stepId: accessProductDetail
        description: "User selects a product to view detailed information."
        operationId: productByProductIdV4
        parameters:
          - name: productId
            in: path
            value: $steps.getGrid.outputs.productId
          - name: storeId
            in: path
            value: $steps.selectStoreAndLanguage.outputs.storeId
          - name: locale
            in: path
            value: $steps.selectStoreAndLanguage.outputs.selectedLocale
        successCriteria:
          - condition: $statusCode == 200
        outputs:
          productDetails: $response.body
    outputs:
      productDetails: $steps.accessProductDetail.outputs.productDetails
